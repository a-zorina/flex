<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flex: stTONs - TON Labs DePool stake tokens contract</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Flex
   </div>
   <div id="projectbrief">Flex exchange system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classstTONs.html">stTONs</a> - TON Labs DePool stake tokens contract </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md4"></a>
Contract interfaces:</h1>
<ul>
<li><a class="el" href="structtvm_1_1IstTONs.html" title="stTONs contract interface">tvm::IstTONs</a></li>
<li><a class="el" href="structtvm_1_1IstTONsNotify.html" title="Notification about lend ownership to destination contracts.">tvm::IstTONsNotify</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Expected working sequence:</h1>
<ul>
<li>Create personal instance of <a class="el" href="classstTONs.html">stTONs</a> contract. Using deploy message with prepared persistent data and noop call (<a class="el" href="structtvm_1_1IstTONs.html#a7a644c4602163dfd3f0d074cbbf0ee5e" title="Empty noop function for deploying.">tvm::IstTONs::onDeploy()</a>). <a class="el" href="classstTONs.html">stTONs</a> contract should be created for one specific DePool address.</li>
<li>Call DePool -&gt; <a class="el" href="structtvm_1_1IDePool.html#a47fac49dd29d0caad8deaa1548761d16" title="Transfer participant&#39;s stake to destination contract.">tvm::IDePool::transferStake()</a> to transfer stake at <a class="el" href="classstTONs.html">stTONs</a> contract address.</li>
<li><a class="el" href="classstTONs.html">stTONs</a> contract will receive <a class="el" href="structtvm_1_1IParticipant.html#a4f52cd5295c547f8d509db8261be1572" title="Notification about stake transfer.">tvm::IParticipant::onTransfer()</a> notification and will increase token balance at the stake value.</li>
<li>Call <a class="el" href="classstTONs.html">stTONs</a> -&gt; <a class="el" href="structtvm_1_1IstTONs.html#a4966031e34c19e266c77051e097fae97" title="Lend ownership to some contract for lend_balance until lend_finish_time.">tvm::IstTONs::lendOwnership()</a> to lend ownership for specific tokens amount to service contract (mintofarm or other). <a class="el" href="classstTONs.html">stTONs</a> contract sends <a class="el" href="structtvm_1_1IstTONsNotify.html#a922c9405e2f65db228165c47daf1cd73" title="Lend ownership notification.">tvm::IstTONsNotify::onLendOwnership()</a> to the service contract.</li>
<li>Service contract should verify <a class="el" href="classstTONs.html">stTONs</a> to be a correct version by sender address, comparing it with the expected deploy address.</li>
<li>When all lend ownership is expired or terminated by service contracts (using <a class="el" href="structtvm_1_1IstTONs.html#a00cc46c63d5845f00142244a34774372" title="Return ownership back to the original owner (for the provided amount of tokens)">tvm::IstTONs::returnOwnership()</a>), <a class="el" href="classstTONs.html">stTONs</a> owner may request <a class="el" href="structtvm_1_1IstTONs.html#af7c473e7da2faf211b1f111134ec6b22">tvm::IstTONs::returnStake()</a> to transfer stake back to some other contract.</li>
<li><a class="el" href="classstTONs.html">stTONs</a> contract when receive returnStake, will send <a class="el" href="structtvm_1_1IDePool.html#a47fac49dd29d0caad8deaa1548761d16" title="Transfer participant&#39;s stake to destination contract.">tvm::IDePool::transferStake()</a> with amount = 0 to send full stake.</li>
<li>DePool will send notification with error code to <a class="el" href="classstTONs.html">stTONs</a>, <a class="el" href="classstTONs.html">stTONs</a> will save it to <code>last_depool_error_</code>.</li>
<li><a class="el" href="classstTONs.html">stTONs</a> owner may request <a class="el" href="structtvm_1_1IstTONs.html#af7c473e7da2faf211b1f111134ec6b22">tvm::IstTONs::returnStake()</a> more times (if there is some error in <code>last_depool_error_</code>).</li>
<li><a class="el" href="classstTONs.html">stTONs</a> owner will call <a class="el" href="structtvm_1_1IstTONs.html#a503ff67b65c33f351cd58a64879db213">tvm::IstTONs::finalize()</a> to terminate contract and send all remaining crystals to dst address. If there is some error in <code>last_depool_error_</code>, distinct from <code>STATUS_SUCCESS</code>/<code>STATUS_DEPOOL_CLOSED</code>/<code>STATUS_NO_PARTICIPANT</code> and <code>ignore_errors</code> flag is not set, the call will be failed. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
